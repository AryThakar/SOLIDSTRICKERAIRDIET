<!DOCTYPE html>
<html lang="en" class="overflow-x-hidden">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Nutrition OS</title>
    
    <!-- PWA & Mobile Config -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0a" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#f8fafc" media="(prefers-color-scheme: light)">
    
    <!-- Icons (Embedded SVG Data URIs) - Updated to Premium Bolt Icon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='g1' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23f97316'/%3E%3Cstop offset='100%25' stop-color='%23ea580c'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' rx='128' fill='url(%23g1)'/%3E%3Cpath d='M320 128L224 288H272L192 448L288 288H240L320 128Z' fill='white' stroke='rgba(0,0,0,0.1)' stroke-width='16' stroke-linejoin='round'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='g1' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23f97316'/%3E%3Cstop offset='100%25' stop-color='%23ea580c'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' rx='128' fill='url(%23g1)'/%3E%3Cpath d='M320 128L224 288H272L192 448L288 288H240L320 128Z' fill='white' stroke='rgba(0,0,0,0.1)' stroke-width='16' stroke-linejoin='round'/%3E%3C/svg%3E">
    
    <!-- Inline Manifest for "Install App" Trigger -->
    <link rel="manifest" id="manifest-placeholder">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -webkit-tap-highlight-color: transparent; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 3px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(156, 163, 175, 0.3); border-radius: 20px; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        @keyframes liquid-pulse {
            0%, 100% { filter: brightness(1); box-shadow: 0 0 10px rgba(249, 115, 22, 0.3); }
            50% { filter: brightness(1.1); box-shadow: 0 0 20px rgba(249, 115, 22, 0.5); }
        }
        
        .liquid-glow { animation: liquid-pulse 3s infinite; }
        button, input { touch-action: manipulation; }
        
        /* Floating Nav Blur */
        .glass-nav {
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 transition-colors duration-300 overflow-x-hidden w-full">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- PWA INSTALLATION LOGIC (Service Worker & Manifest Injection) ---
        // This is required to trick Chrome Android into providing the full "Install App" experience
        // instead of just a "Shortcut".
        const setupPWA = () => {
            // New Premium Icon URL
            const premiumIcon = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='g1' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23f97316'/%3E%3Cstop offset='100%25' stop-color='%23ea580c'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' rx='128' fill='url(%23g1)'/%3E%3Cpath d='M320 128L224 288H272L192 448L288 288H240L320 128Z' fill='white' stroke='rgba(0,0,0,0.1)' stroke-width='16' stroke-linejoin='round'/%3E%3C/svg%3E";

            // 1. Dynamic Manifest Injection (Ensures correct paths)
            const manifest = {
                "name": "Nutrition OS",
                "short_name": "NutritionOS",
                "start_url": ".",
                "display": "standalone",
                "background_color": "#0a0a0a",
                "theme_color": "#ea580c",
                "orientation": "portrait",
                "icons": [
                    {
                        "src": premiumIcon,
                        "sizes": "512x512",
                        "type": "image/svg+xml",
                        "purpose": "any maskable" 
                    },
                    {
                        "src": premiumIcon,
                        "sizes": "192x192",
                        "type": "image/svg+xml",
                        "purpose": "any maskable" 
                    }
                ]
            };
            const stringManifest = JSON.stringify(manifest);
            const blobManifest = new Blob([stringManifest], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(blobManifest);
            document.querySelector('#manifest-placeholder').setAttribute('href', manifestURL);

            // 2. Service Worker Injection (Required for WebAPK/Install Prompt)
            if ('serviceWorker' in navigator) {
                const swCode = `
                    self.addEventListener('install', (event) => self.skipWaiting());
                    self.addEventListener('activate', (event) => self.clients.claim());
                    self.addEventListener('fetch', (event) => {
                        // Passthrough - we don't actually cache, we just exist to satisfy the PWA install criteria
                    });
                `;
                const blobSw = new Blob([swCode], {type: 'text/javascript'});
                const swUrl = URL.createObjectURL(blobSw);
                
                // Note: Blob-based SW might have origin limitations in strict contexts, 
                // but it's the best attempt for a single-file solution.
                navigator.serviceWorker.register(swUrl)
                    .then(() => console.log('SW Registered'))
                    .catch(e => console.log('SW Error:', e));
            }
        };
        // Run PWA Setup
        setupPWA();

        // --- SOUND ENGINE (Local Synthesis) ---
        const SoundEngine = {
            ctx: null,
            init: () => {
                if (!SoundEngine.ctx) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (AudioContext) SoundEngine.ctx = new AudioContext();
                }
                if (SoundEngine.ctx && SoundEngine.ctx.state === 'suspended') {
                    SoundEngine.ctx.resume();
                }
            },
            play: (type) => {
                SoundEngine.init();
                if (!SoundEngine.ctx) return;
                
                const ctx = SoundEngine.ctx;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                const now = ctx.currentTime;
                osc.connect(gain);
                gain.connect(ctx.destination);

                switch (type) {
                    case 'tap': // Tab switch / Selection
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(600, now);
                        osc.frequency.exponentialRampToValueAtTime(100, now + 0.08);
                        gain.gain.setValueAtTime(0.03, now);
                        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.08);
                        osc.start(now);
                        osc.stop(now + 0.08);
                        break;
                    case 'pop': // Add Item
                        osc.type = 'triangle';
                        osc.frequency.setValueAtTime(300, now);
                        osc.frequency.linearRampToValueAtTime(500, now + 0.05);
                        gain.gain.setValueAtTime(0.05, now);
                        gain.gain.linearRampToValueAtTime(0.001, now + 0.05);
                        osc.start(now);
                        osc.stop(now + 0.05);
                        break;
                    case 'tick': // Decrease Item
                        osc.type = 'triangle';
                        osc.frequency.setValueAtTime(400, now);
                        osc.frequency.linearRampToValueAtTime(200, now + 0.05);
                        gain.gain.setValueAtTime(0.05, now);
                        gain.gain.linearRampToValueAtTime(0.001, now + 0.05);
                        osc.start(now);
                        osc.stop(now + 0.05);
                        break;
                    case 'success': // Goal Met / Check
                        osc.type = 'sine';
                        // Note 1
                        osc.frequency.setValueAtTime(523.25, now); // C5
                        gain.gain.setValueAtTime(0.05, now);
                        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
                        // Note 2 (Major 3rd)
                        const osc2 = ctx.createOscillator();
                        const gain2 = ctx.createGain();
                        osc2.connect(gain2);
                        gain2.connect(ctx.destination);
                        osc2.frequency.setValueAtTime(659.25, now + 0.05); // E5
                        gain2.gain.setValueAtTime(0, now);
                        gain2.gain.setValueAtTime(0.05, now + 0.05);
                        gain2.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
                        
                        osc.start(now);
                        osc.stop(now + 0.2);
                        osc2.start(now + 0.05);
                        osc2.stop(now + 0.3);
                        break;
                    case 'toggle': // Dark mode / Reset
                        // White noise burst
                        const bufferSize = ctx.sampleRate * 0.05; // 50ms
                        const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                        const data = buffer.getChannelData(0);
                        for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
                        
                        const noise = ctx.createBufferSource();
                        noise.buffer = buffer;
                        const noiseGain = ctx.createGain();
                        noise.connect(noiseGain);
                        noiseGain.connect(ctx.destination);
                        
                        noiseGain.gain.setValueAtTime(0.02, now);
                        noiseGain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                        noise.start(now);
                        break;
                }
            }
        };

        // --- ICONS ---
        const Icons = {
            Check: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M5 13l4 4L19 7" /></svg>,
            Reset: () => <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>,
            ChevronDown: () => <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M19 9l-7 7-7-7" /></svg>,
            Sun: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
            Moon: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>,
            Fire: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z" /></svg>,
            Muscle: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
            Grain: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20 12V8H6a2 2 0 01-2-2 2 2 0 012-2h2a2 2 0 012 2v10a2 2 0 002 2h2a2 2 0 002-2V6a2 2 0 012-2h2a2 2 0 012 2v6c0 3-3 6-6 6H6" /></svg>,
            Leaf: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
            Oil: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>,
            Bone: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>,
            Magnet: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>,
            Salt: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20 12V8H6a2 2 0 01-2-2 2 2 0 012-2h2a2 2 0 012 2v10a2 2 0 002 2h2a2 2 0 002-2V6a2 2 0 012-2h2a2 2 0 012 2v6c0 3-3 6-6 6H6" /></svg>,
            Bolt: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>,
            Shield: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            Coin: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            Star: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg>,
            Eye: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>,
            Fish: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>, 
            Brain: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>,
            Hair: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            Alert: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>,
            Droplet: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>,
            Pill: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            Lightning: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>,
            Beaker: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>,
            Water: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20 14.66V20a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 01-2-2V6a2 2 0 01-2-2V6" /></svg>,
            Plus: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4v16m8-8H4" /></svg>,
            Minus: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20 12H4" /></svg>,
            Clock: () => <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [darkMode, setDarkMode] = useState(true);
            const [expandedCategories, setExpandedCategories] = useState({});
            const [currentTime, setCurrentTime] = useState(new Date());

            // --- TIME UPDATE ---
            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 60000);
                return () => clearInterval(timer);
            }, []);
            
            // --- STATE WITH PERSISTENCE (Auto-Reset Water) ---
            const [waterData, setWaterData] = useState(() => {
                try {
                    const saved = localStorage.getItem('nc_water_data_v11');
                    const parsed = saved ? JSON.parse(saved) : { count: 0, date: new Date().toDateString() };
                    // Auto-Reset Check
                    if (parsed.date !== new Date().toDateString()) {
                        return { count: 0, date: new Date().toDateString() };
                    }
                    return parsed;
                } catch { return { count: 0, date: new Date().toDateString() }; }
            });

            // Update water count wrapper
            const updateWater = (delta) => {
                SoundEngine.play(delta > 0 ? 'pop' : 'tick');
                setWaterData(prev => {
                    const newCount = Math.max(0, prev.count + delta);
                    return { count: newCount, date: new Date().toDateString() };
                });
            };

            const [checklist, setChecklist] = useState(() => {
                try { return JSON.parse(localStorage.getItem('nc_checklist_v2')) || {}; } catch { return {}; }
            });

            // --- IDEAL QUANTITIES ---
            const idealQuantities = {
                "Amul Dahi (Cup 200g)": 1, "Amul Taaza Milk (250ml)": 1, "Moringa Powder (6g)": 1,
                "Peanuts (10g ~10 nuts)": 0, "Mustard Seeds/Rai (3g)": 1, "Cumin/Jeera (3g)": 1,
                "Turmeric/Haldi (1g)": 1, "Pumpkin Seeds (10g)": 1, "Sunflower Seeds (5g)": 1,
                "Chia Seeds (12g)": 0.8, "Sesame Seeds (5g)": 1, "Almonds (5 nuts ~7g)": 1,
                "Walnuts (4 halves ~14g)": 1, "Roasted Channa (50g)": 1.2, "Dal/Cooked (240g)": 1.5,
                "Tomato (~50g)": 1, "Onion (~30g)": 1, "Potato (~40g)": 1,
                "Roti (2.5 medium ~125g)": 0.8, "Rice (150g cooked)": 0.5,
                "Vit D3 (1000 IU)": 1, "Vit C (125mg)": 1, "B12 (1500mcg alt)": 1,
                "Banana (1 medium)": 1, "Cooking Oil (Hostel 15ml)": 1, "Salt (1 tsp)": 0.5
            };

            const [quantities, setQuantities] = useState(() => {
                try {
                const saved = localStorage.getItem('nc_quantities_v2_9');
                return saved ? JSON.parse(saved) : idealQuantities;
                } catch { return idealQuantities; }
            });

            // --- PERSISTENCE ---
            useEffect(() => { localStorage.setItem('nc_quantities_v2_9', JSON.stringify(quantities)); }, [quantities]);
            useEffect(() => { localStorage.setItem('nc_water_data_v11', JSON.stringify(waterData)); }, [waterData]);
            useEffect(() => { localStorage.setItem('nc_checklist_v2', JSON.stringify(checklist)); }, [checklist]);

            // Apply body class for dark mode
            useEffect(() => {
                if (darkMode) {
                    document.body.classList.add('bg-neutral-950', 'text-neutral-100');
                    document.body.classList.remove('bg-slate-50', 'text-slate-900');
                } else {
                    document.body.classList.remove('bg-neutral-950', 'text-neutral-100');
                    document.body.classList.add('bg-slate-50', 'text-slate-900');
                }
            }, [darkMode]);

            const toggleCategory = (cat) => { 
                SoundEngine.play('tap');
                setExpandedCategories(prev => ({ ...prev, [cat]: !prev[cat] })); 
            };
            const handleQuantityChange = (food, value) => { 
                setQuantities(prev => ({ ...prev, [food]: Math.max(0, parseFloat(value) || 0) })); 
            };
            const resetToIdeal = () => { 
                SoundEngine.play('toggle');
                setQuantities({ ...idealQuantities }); 
            };
            const toggleCheck = (id) => { 
                if (!checklist[id]) SoundEngine.play('success');
                else SoundEngine.play('tick');
                setChecklist(prev => ({ ...prev, [id]: !prev[id] })); 
            };
            const handleTabChange = (tab) => {
                SoundEngine.play('tap');
                setActiveTab(tab);
            }
            const toggleDarkMode = () => {
                SoundEngine.play('toggle');
                setDarkMode(!darkMode);
            }

            // --- DATA ---
            const foodDatabase = {
                dairy: {
                    "Amul Dahi (Cup 200g)": { calories: 130, protein: 7.4, carbs: 9.6, fat: 7.0, fiber: 0, calcium: 300, iron: 0.2, magnesium: 22, potassium: 280, sodium: 80, zinc: 1.2, copper: 0.02, selenium: 4, vitA: 95, vitC: 0, vitD: 0, vitE: 0.1, vitK: 0.5, thiamin: 0.08, riboflavin: 0.28, niacin: 0.2, vitB6: 0.08, folate: 10, vitB12: 0.8, omega3: 0, omega6: 0.2, oxalate: 0 },
                    "Amul Taaza Milk (250ml)": { calories: 150, protein: 7.5, carbs: 11.8, fat: 7.5, fiber: 0, calcium: 375, iron: 0.1, magnesium: 27, potassium: 380, sodium: 125, zinc: 1.0, copper: 0.03, selenium: 5, vitA: 110, vitC: 0, vitD: 1.0, vitE: 0.1, vitK: 0.2, thiamin: 0.1, riboflavin: 0.4, niacin: 0.2, vitB6: 0.1, folate: 12, vitB12: 1.1, omega3: 0, omega6: 0.2, oxalate: 0 },
                },
                seeds: {
                    "Moringa Powder (6g)": { calories: 20, protein: 1.7, carbs: 2.5, fat: 0.4, fiber: 1.2, calcium: 180, iron: 2.0, magnesium: 22, potassium: 210, sodium: 3, zinc: 0.4, copper: 0.06, selenium: 0.5, vitA: 128, vitC: 10, vitD: 0, vitE: 6.0, vitK: 150, thiamin: 0.16, riboflavin: 0.40, niacin: 0.48, vitB6: 0.72, folate: 24, vitB12: 0, omega3: 0.1, omega6: 0.1, oxalate: 100 },
                    "Chia Seeds (12g)": { calories: 58, protein: 2.4, carbs: 5.0, fat: 3.7, fiber: 4.8, calcium: 75, iron: 0.9, magnesium: 40, potassium: 50, sodium: 2, zinc: 0.6, copper: 0.01, selenium: 7, vitA: 6, vitC: 0, vitD: 0, vitE: 0.1, vitK: 0.7, thiamin: 0.07, riboflavin: 0.02, niacin: 1.0, vitB6: 0.01, folate: 6, vitB12: 0, omega3: 2.1, omega6: 0.7, oxalate: 140 },
                    "Pumpkin Seeds (10g)": { calories: 56, protein: 2.4, carbs: 1.5, fat: 4.7, fiber: 0.6, calcium: 5, iron: 0.8, magnesium: 55, potassium: 80, sodium: 2, zinc: 0.8, copper: 0.13, selenium: 1, vitA: 2, vitC: 0, vitD: 0, vitE: 0.2, vitK: 0.5, thiamin: 0.03, riboflavin: 0.02, niacin: 0.2, vitB6: 0.01, folate: 6, vitB12: 0, omega3: 0.02, omega6: 2.5, oxalate: 7 },
                    "Sunflower Seeds (5g)": { calories: 29, protein: 1.0, carbs: 1.0, fat: 2.6, fiber: 0.5, calcium: 4, iron: 0.3, magnesium: 16, potassium: 30, sodium: 0, zinc: 0.3, copper: 0.09, selenium: 3, vitA: 0, vitC: 0, vitD: 0, vitE: 1.8, vitK: 0.2, thiamin: 0.08, riboflavin: 0.02, niacin: 0.4, vitB6: 0.07, folate: 11, vitB12: 0, omega3: 0.0, omega6: 2.3, oxalate: 2 },
                    "Sesame Seeds (5g)": { calories: 29, protein: 0.9, carbs: 1.2, fat: 2.5, fiber: 0.6, calcium: 49, iron: 0.7, magnesium: 18, potassium: 23, sodium: 1, zinc: 0.4, copper: 0.2, selenium: 2, vitA: 0, vitC: 0, vitD: 0, vitE: 0.1, vitK: 0.5, thiamin: 0.04, riboflavin: 0.01, niacin: 0.2, vitB6: 0.04, folate: 5, vitB12: 0, omega3: 0.02, omega6: 1.1, oxalate: 70 },
                },
                nuts: {
                    "Almonds (5 nuts ~7g)": { calories: 41, protein: 1.5, carbs: 1.5, fat: 3.5, fiber: 0.8, calcium: 19, iron: 0.3, magnesium: 19, potassium: 52, sodium: 0, zinc: 0.2, copper: 0.07, selenium: 0.3, vitA: 0, vitC: 0, vitD: 0, vitE: 1.8, vitK: 0, thiamin: 0.01, riboflavin: 0.08, niacin: 0.3, vitB6: 0.01, folate: 3, vitB12: 0, omega3: 0, omega6: 0.8, oxalate: 30 },
                    "Walnuts (4 halves ~14g)": { calories: 92, protein: 2.0, carbs: 1.9, fat: 9.1, fiber: 0.9, calcium: 14, iron: 0.4, magnesium: 22, potassium: 62, sodium: 0, zinc: 0.4, copper: 0.22, selenium: 0.7, vitA: 3, vitC: 0, vitD: 0, vitE: 0.1, vitK: 0.4, thiamin: 0.05, riboflavin: 0.02, niacin: 0.2, vitB6: 0.07, folate: 14, vitB12: 0, omega3: 1.3, omega6: 5.4, oxalate: 20 },
                    "Peanuts (10g ~10 nuts)": { calories: 57, protein: 2.6, carbs: 1.6, fat: 4.9, fiber: 0.9, calcium: 9, iron: 0.5, magnesium: 17, potassium: 70, sodium: 2, zinc: 0.3, copper: 0.1, selenium: 0.7, vitA: 0, vitC: 0, vitD: 0, vitE: 0.8, vitK: 0, thiamin: 0.06, riboflavin: 0.01, niacin: 1.2, vitB6: 0.03, folate: 24, vitB12: 0, omega3: 0, omega6: 1.6, oxalate: 7 },
                    "Roasted Channa (50g)": { calories: 180, protein: 9.5, carbs: 27.0, fat: 3.0, fiber: 8.0, calcium: 45, iron: 2.5, magnesium: 48, potassium: 291, sodium: 100, zinc: 1.3, copper: 0.28, selenium: 4, vitA: 3, vitC: 0, vitD: 0, vitE: 0.3, vitK: 4, thiamin: 0.19, riboflavin: 0.07, niacin: 0.5, vitB6: 0.27, folate: 172, vitB12: 0, omega3: 0.1, omega6: 1.3, oxalate: 25 },
                },
                meals: {
                    "Dal/Cooked (240g)": { calories: 230, protein: 17.5, carbs: 38.0, fat: 0.8, fiber: 15.6, calcium: 70, iron: 6.6, magnesium: 70, potassium: 730, sodium: 450, zinc: 2.5, copper: 0.7, selenium: 12, vitA: 20, vitC: 3, vitD: 0, vitE: 0.2, vitK: 6, thiamin: 0.34, riboflavin: 0.15, niacin: 2.1, vitB6: 0.35, folate: 358, vitB12: 0, omega3: 0, omega6: 0.1, oxalate: 15 },
                    "Roti (2.5 medium ~125g)": { calories: 300, protein: 9.0, carbs: 58.0, fat: 3.8, fiber: 7.5, calcium: 25, iron: 3.4, magnesium: 90, potassium: 200, sodium: 150, zinc: 1.8, copper: 0.3, selenium: 52, vitA: 0, vitC: 0, vitD: 0, vitE: 0.5, vitK: 1, thiamin: 0.38, riboflavin: 0.13, niacin: 4.5, vitB6: 0.28, folate: 38, vitB12: 0, omega3: 0, omega6: 0.8, oxalate: 5 },
                    "Rice (150g cooked)": { calories: 195, protein: 4.0, carbs: 43.0, fat: 0.4, fiber: 0.6, calcium: 15, iron: 0.3, magnesium: 19, potassium: 55, sodium: 200, zinc: 0.8, copper: 0.07, selenium: 11, vitA: 0, vitC: 0, vitD: 0, vitE: 0.1, vitK: 0, thiamin: 0.13, riboflavin: 0.02, niacin: 2.3, vitB6: 0.11, folate: 3, vitB12: 0, omega3: 0, omega6: 0.1, oxalate: 2 },
                    "Tomato (~50g)": { calories: 9, protein: 0.4, carbs: 2.0, fat: 0.1, fiber: 0.6, calcium: 5, iron: 0.1, magnesium: 5, potassium: 118, sodium: 2, zinc: 0.1, copper: 0.03, selenium: 0.2, vitA: 21, vitC: 7, vitD: 0, vitE: 0.3, vitK: 4, thiamin: 0.02, riboflavin: 0.01, niacin: 0.3, vitB6: 0.04, folate: 8, vitB12: 0, omega3: 0, omega6: 0, oxalate: 2.5 },
                    "Onion (~30g)": { calories: 12, protein: 0.3, carbs: 2.8, fat: 0.0, fiber: 0.5, calcium: 7, iron: 0.1, magnesium: 3, potassium: 44, sodium: 1, zinc: 0.1, copper: 0.02, selenium: 0.2, vitA: 0, vitC: 2, vitD: 0, vitE: 0.0, vitK: 0.1, thiamin: 0.01, riboflavin: 0.01, niacin: 0.0, vitB6: 0.04, folate: 6, vitB12: 0, omega3: 0, omega6: 0, oxalate: 1.5 },
                    "Potato (~40g)": { calories: 31, protein: 0.8, carbs: 7.1, fat: 0.0, fiber: 0.9, calcium: 5, iron: 0.3, magnesium: 9, potassium: 166, sodium: 2, zinc: 0.1, copper: 0.04, selenium: 0.1, vitA: 0, vitC: 8, vitD: 0, vitE: 0.0, vitK: 0.8, thiamin: 0.03, riboflavin: 0.01, niacin: 0.4, vitB6: 0.11, folate: 6, vitB12: 0, omega3: 0, omega6: 0, oxalate: 3 },
                    "Cooking Oil (Hostel 15ml)": { calories: 135, protein: 0, carbs: 0, fat: 15.0, fiber: 0, calcium: 0, iron: 0, magnesium: 0, potassium: 0, sodium: 0, zinc: 0, copper: 0, selenium: 0, vitA: 0, vitC: 0, vitD: 0, vitE: 2.0, vitK: 8, thiamin: 0, riboflavin: 0, niacin: 0, vitB6: 0, folate: 0, vitB12: 0, omega3: 0.8, omega6: 7.5, oxalate: 0 },
                    "Banana (1 medium)": { calories: 105, protein: 1.3, carbs: 27.0, fat: 0.4, fiber: 3.1, calcium: 6, iron: 0.3, magnesium: 32, potassium: 422, sodium: 1, zinc: 0.2, copper: 0.09, selenium: 1, vitA: 4, vitC: 10, vitD: 0, vitE: 0.1, vitK: 0.6, thiamin: 0.04, riboflavin: 0.09, niacin: 0.8, vitB6: 0.43, folate: 24, vitB12: 0, omega3: 0, omega6: 0, oxalate: 10 },
                },
                spices: {
                    "Mustard Seeds/Rai (3g)": { calories: 16, protein: 0.6, carbs: 0.7, fat: 1.2, fiber: 0.3, calcium: 15, iron: 0.2, magnesium: 11, potassium: 22, sodium: 0, zinc: 0.15, copper: 0.02, selenium: 2, vitA: 1, vitC: 0, vitD: 0, vitE: 0.6, vitK: 0.2, thiamin: 0.02, riboflavin: 0.01, niacin: 0.1, vitB6: 0.01, folate: 2, vitB12: 0, omega3: 0.1, omega6: 0.3, oxalate: 5 },
                    "Cumin/Jeera (3g)": { calories: 13, protein: 0.5, carbs: 1.3, fat: 0.7, fiber: 0.3, calcium: 28, iron: 2.0, magnesium: 11, potassium: 53, sodium: 5, zinc: 0.15, copper: 0.03, selenium: 0.5, vitA: 11, vitC: 0.2, vitD: 0, vitE: 0.1, vitK: 0.1, thiamin: 0.02, riboflavin: 0.01, niacin: 0.1, vitB6: 0.01, folate: 0.3, vitB12: 0, omega3: 0, omega6: 0.1, oxalate: 10 },
                    "Turmeric/Haldi (1g)": { calories: 3.5, protein: 0.1, carbs: 0.6, fat: 0.1, fiber: 0.2, calcium: 2, iron: 0.7, magnesium: 2, potassium: 25, sodium: 0, zinc: 0.04, copper: 0.01, selenium: 0.1, vitA: 0, vitC: 0.3, vitD: 0, vitE: 0, vitK: 0.1, thiamin: 0, riboflavin: 0, niacin: 0, vitB6: 0, folate: 0.4, vitB12: 0, omega3: 0, omega6: 0, oxalate: 20 },
                    "Salt (1 tsp)": { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0, calcium: 0, iron: 0, magnesium: 0, potassium: 0, sodium: 2300, zinc: 0, copper: 0, selenium: 0, vitA: 0, vitC: 0, vitD: 0, vitE: 0, vitK: 0, thiamin: 0, riboflavin: 0, niacin: 0, vitB6: 0, folate: 0, vitB12: 0, omega3: 0, omega6: 0, oxalate: 0 },
                },
                supplements: {
                    "Vit D3 (1000 IU)": { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0, calcium: 0, iron: 0, magnesium: 0, potassium: 0, sodium: 0, zinc: 0, copper: 0, selenium: 0, vitA: 0, vitC: 0, vitD: 25, vitE: 0, vitK: 0, thiamin: 0, riboflavin: 0, niacin: 0, vitB6: 0, folate: 0, vitB12: 0, omega3: 0, omega6: 0, oxalate: 0 },
                    "Vit C (125mg)": { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0, calcium: 0, iron: 0, magnesium: 0, potassium: 0, sodium: 0, zinc: 0, copper: 0, selenium: 0, vitA: 0, vitC: 125, vitD: 0, vitE: 0, vitK: 0, thiamin: 0, riboflavin: 0, niacin: 0, vitB6: 0, folate: 0, vitB12: 0, omega3: 0, omega6: 0, oxalate: 0 },
                    "B12 (1500mcg alt)": { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0, calcium: 0, iron: 0, magnesium: 0, potassium: 0, sodium: 0, zinc: 0, copper: 0, selenium: 0, vitA: 0, vitC: 0, vitD: 0, vitE: 0, vitK: 0, thiamin: 0, riboflavin: 0, niacin: 0, vitB6: 0, folate: 0, vitB12: 750, omega3: 0, omega6: 0, oxalate: 0 },
                }
            };

            const totals = useMemo(() => {
                const flatFoodData = Object.assign({}, ...Object.values(foodDatabase));
                return Object.entries(flatFoodData).reduce((acc, [foodName, nutrients]) => {
                    const qty = quantities[foodName] || 0;
                    Object.keys(nutrients).forEach(nutrient => { acc[nutrient] = (acc[nutrient] || 0) + (nutrients[nutrient] * qty); });
                    return acc;
                }, {});
            }, [quantities]);

            const rda = {
                calories: 2110, protein: 54, carbs: 300, fat: 60, fiber: 30,
                calcium: 1000, iron: 19, magnesium: 440, potassium: 3500, sodium: 2300, zinc: 17, copper: 1.7, selenium: 40,
                vitA: 1000, vitC: 80, vitD: 15, vitE: 10, vitK: 55,
                thiamin: 1.8, riboflavin: 2.5, niacin: 18, vitB6: 2.4, folate: 300, vitB12: 2.5,
                omega3: 1.6, omega6: 14 // Added Target for Omega 6
            };

            const nutrientDisplayCategories = {
                'Macronutrients': [
                    { k: 'calories', l: 'Calories', s: 'Energy', u: 'kcal', icon: <Icons.Fire />, bg: 'bg-orange-500/10', text: 'text-orange-500' },
                    { k: 'protein', l: 'Protein', s: 'Amino Acids', u: 'g', icon: <Icons.Muscle />, bg: 'bg-blue-500/10', text: 'text-blue-500' },
                    { k: 'carbs', l: 'Carbohydrates', s: 'Glucose', u: 'g', icon: <Icons.Grain />, bg: 'bg-amber-500/10', text: 'text-amber-500' },
                    { k: 'fat', l: 'Total Fat', s: 'Lipids', u: 'g', icon: <Icons.Oil />, bg: 'bg-yellow-500/10', text: 'text-yellow-500' },
                    { k: 'fiber', l: 'Fiber', s: 'Cellulose', u: 'g', icon: <Icons.Leaf />, bg: 'bg-green-500/10', text: 'text-green-500' }
                ],
                'Minerals': [
                    { k: 'calcium', l: 'Calcium', s: 'Ca', u: 'mg', icon: <Icons.Bone />, bg: 'bg-slate-500/10', text: 'text-slate-500' },
                    { k: 'iron', l: 'Iron', s: 'Fe', u: 'mg', icon: <Icons.Magnet />, bg: 'bg-red-500/10', text: 'text-red-500' },
                    { k: 'sodium', l: 'Sodium', s: 'Na', u: 'mg', icon: <Icons.Salt />, bg: 'bg-cyan-500/10', text: 'text-cyan-500' },
                    { k: 'magnesium', l: 'Magnesium', s: 'Mg', u: 'mg', icon: <Icons.Bolt />, bg: 'bg-indigo-500/10', text: 'text-indigo-500' },
                    { k: 'potassium', l: 'Potassium', s: 'K', u: 'mg', icon: <Icons.Bolt />, bg: 'bg-violet-500/10', text: 'text-violet-500' }, 
                    { k: 'zinc', l: 'Zinc', s: 'Zn', u: 'mg', icon: <Icons.Shield />, bg: 'bg-teal-500/10', text: 'text-teal-500' },
                    { k: 'copper', l: 'Copper', s: 'Cu', u: 'mg', icon: <Icons.Coin />, bg: 'bg-orange-600/10', text: 'text-orange-600' },
                    { k: 'selenium', l: 'Selenium', s: 'Se', u: 'µg', icon: <Icons.Star />, bg: 'bg-purple-500/10', text: 'text-purple-500' }
                ],
                'Vitamins': [
                    { k: 'vitD', l: 'Vitamin D3', s: 'Cholecalciferol', u: 'µg', icon: <Icons.Sun />, bg: 'bg-yellow-400/10', text: 'text-yellow-500' },
                    { k: 'vitC', l: 'Vitamin C', s: 'Ascorbic Acid', u: 'mg', icon: <Icons.Sun />, bg: 'bg-orange-400/10', text: 'text-orange-500' },
                    { k: 'vitA', l: 'Vitamin A', s: 'Retinol', u: 'µg', icon: <Icons.Eye />, bg: 'bg-orange-600/10', text: 'text-orange-600' },
                    { k: 'vitE', l: 'Vitamin E', s: 'Tocopherol', u: 'mg', icon: <Icons.Hair />, bg: 'bg-pink-500/10', text: 'text-pink-500' },
                    { k: 'vitK', l: 'Vitamin K', s: 'Phylloquinone', u: 'µg', icon: <Icons.Leaf />, bg: 'bg-green-600/10', text: 'text-green-600' },
                    { k: 'vitB12', l: 'Vitamin B12', s: 'Cobalamin', u: 'µg', icon: <Icons.Pill />, bg: 'bg-rose-500/10', text: 'text-rose-500' },
                    { k: 'folate', l: 'Vitamin B9', s: 'Folate', u: 'µg', icon: <Icons.Leaf />, bg: 'bg-green-500/10', text: 'text-green-500' },
                    { k: 'vitB6', l: 'Vitamin B6', s: 'Pyridoxine', u: 'mg', icon: <Icons.Lightning />, bg: 'bg-yellow-600/10', text: 'text-yellow-600' },
                    { k: 'riboflavin', l: 'Vitamin B2', s: 'Riboflavin', u: 'mg', icon: <Icons.Lightning />, bg: 'bg-yellow-600/10', text: 'text-yellow-600' },
                    { k: 'thiamin', l: 'Vitamin B1', s: 'Thiamin', u: 'mg', icon: <Icons.Lightning />, bg: 'bg-yellow-600/10', text: 'text-yellow-600' },
                    { k: 'niacin', l: 'Vitamin B3', s: 'Niacin', u: 'mg', icon: <Icons.Lightning />, bg: 'bg-yellow-600/10', text: 'text-yellow-600' }
                ],
                'Healthy Fats': [
                    { k: 'omega3', l: 'Omega-3', s: 'Alpha-Linolenic', u: 'g', icon: <Icons.Fish />, bg: 'bg-blue-600/10', text: 'text-blue-600' },
                    { k: 'omega6', l: 'Omega-6', s: 'Linoleic Acid', u: 'g', icon: <Icons.Oil />, bg: 'bg-yellow-600/10', text: 'text-yellow-600' }
                ],
                'Safety & Other': [
                    { k: 'oxalate', l: 'Oxalates', s: 'Kidney Load', u: 'mg', icon: <Icons.Alert />, bg: 'bg-red-500/10', text: 'text-red-500' }
                ]
            };

            const getStatusBadge = (val, target, nutrientName) => {
                const safeVal = val || 0;
                const badgeBase = "px-2 py-0.5 rounded-md text-[10px] font-semibold tracking-wide border";
                if (nutrientName === 'oxalate') {
                    const ratio = totals.calcium / (safeVal || 1);
                    if (safeVal < 100) return <span className={`${badgeBase} bg-emerald-500/10 text-emerald-500 border-emerald-500/20`}>Safe</span>;
                    if (safeVal > 500) return <span className={`${badgeBase} bg-red-500/10 text-red-500 border-red-500/20 animate-pulse`}>Danger</span>;
                    if (ratio >= 2) return <span className={`${badgeBase} bg-purple-500/10 text-purple-500 border-purple-500/20`}>Protected</span>;
                    return <span className={`${badgeBase} bg-red-500/10 text-red-500 border-red-500/20`}>Risk</span>;
                }
                if (nutrientName === 'fat') {
                    if (safeVal > 70) return <span className={`${badgeBase} bg-red-500/10 text-red-500 border-red-500/20`}>High</span>;
                    if (safeVal < 40) return <span className={`${badgeBase} bg-amber-500/10 text-amber-500 border-amber-500/20`}>Low</span>;
                    return <span className={`${badgeBase} bg-emerald-500/10 text-emerald-500 border-emerald-500/20`}>Optimal</span>;
                }
                if (nutrientName === 'sodium') {
                    if (safeVal > 2300) return <span className={`${badgeBase} bg-red-500/10 text-red-500 border-red-500/20`}>HIGH</span>;
                    return <span className={`${badgeBase} bg-emerald-500/10 text-emerald-500 border-emerald-500/20`}>Safe</span>;
                }
                if (!target) return <span className="text-gray-400 text-xs">-</span>;
                
                const pct = (safeVal / target) * 100;
                
                if (nutrientName === 'omega6') {
                      if (safeVal > 20) return <span className={`${badgeBase} bg-red-500/10 text-red-500 border-red-500/20`}>High</span>;
                      if (safeVal > 14) return <span className={`${badgeBase} bg-blue-500/10 text-blue-500 border-blue-500/20`}>Surplus</span>;
                      if (pct < 50) return <span className={`${badgeBase} bg-amber-500/10 text-amber-500 border-amber-500/20`}>Low</span>;
                      return <span className={`${badgeBase} bg-emerald-500/10 text-emerald-500 border-emerald-500/20`}>Optimal</span>;
                }
                if (pct < 70) return <span className={`${badgeBase} bg-red-500/10 text-red-500 border-red-500/20`}>Deficient</span>;
                if (pct < 90) return <span className={`${badgeBase} bg-amber-500/10 text-amber-500 border-amber-500/20`}>Low</span>;
                if (pct > 110 && nutrientName !== 'calories') return <span className={`${badgeBase} bg-blue-500/10 text-blue-500 border-blue-500/20`}>Surplus</span>;
                return <span className={`${badgeBase} bg-emerald-500/10 text-emerald-500 border-emerald-500/20`}>Optimal</span>;
            };

            const getHairSkinScore = () => {
                const p = Math.min(totals.protein / 54, 1);
                const c = Math.min(totals.vitC / 80, 1);
                const e = Math.min(totals.vitE / 10, 1);
                const z = Math.min(totals.zinc / 17, 1);
                const o = Math.min(totals.omega3 / 1.6, 1);
                const i = Math.min(totals.iron / 19, 1);
                const a = Math.min(totals.vitA / 1000, 1);
                let total = (p*20) + (c*15) + (e*15) + (z*15) + (o*15) + (i*10) + (a*10);
                if (z < 0.5 || a < 0.5) total = Math.min(total, 75);
                return { total: Math.round(total), p: p*20, c: c*15, e: e*15, z: z*15, o: o*15, i: i*10, a: a*10, zincVal: z, vitAVal: a };
            };
            const hairSkinData = getHairSkinScore();

            const getTips = () => {
                const t = [];
                if (hairSkinData.zincVal < 0.8) t.push({ text: "Zinc low. Add Pumpkin Seeds.", icon: <Icons.Shield /> });
                if (hairSkinData.vitAVal < 0.8) t.push({ text: "Vitamin A low. Eat Moringa.", icon: <Icons.Eye /> });
                if (totals.omega3 < 1.0) t.push({ text: "Omega-3 critical. Soak Chia.", icon: <Icons.Fish /> });
                if (totals.calcium < 800) t.push({ text: "Calcium gap. Drink milk.", icon: <Icons.Bone /> });
                return t;
            }
            const smartTips = getTips();

            // --- COMPONENTS ---
            const StatCard = ({ label, value, max, unit, inverse }) => {
                const safeValue = value || 0;
                const safeMax = max || 1;
                const pct = Math.round((safeValue / safeMax) * 100);
                let color = 'bg-blue-500';
                let textColor = 'text-blue-600';
                let valueColor = darkMode ? 'text-white' : 'text-gray-900';
                if (inverse) {
                    if (pct > 100) { color = 'bg-red-500'; textColor = 'text-red-500'; valueColor = 'text-red-500'; }
                    else if (pct > 85) { color = 'bg-amber-500'; textColor = 'text-amber-500'; valueColor = 'text-amber-500'; }
                    else { color = 'bg-emerald-500'; textColor = 'text-emerald-500'; valueColor = 'text-emerald-500'; }
                } else {
                    if (pct < 70) { color = 'bg-red-500'; textColor = 'text-red-500'; valueColor = 'text-red-500'; }
                    else if (pct < 90) { color = 'bg-amber-500'; textColor = 'text-amber-500'; valueColor = 'text-amber-500'; }
                    else { color = 'bg-emerald-500'; textColor = 'text-emerald-500'; valueColor = 'text-emerald-500'; }
                }

                return (
                <div className={`p-3 rounded-2xl shadow-sm border transition-all ${darkMode ? 'bg-gradient-to-b from-neutral-900 to-neutral-950 border-neutral-800' : 'bg-white border-slate-100'}`}>
                    <div className="flex justify-between items-center mb-1.5">
                    <span className={`text-[10px] uppercase font-bold tracking-wider text-neutral-500`}>{label}</span>
                    <span className={`text-[9px] font-bold px-1.5 py-0.5 rounded-full ${darkMode ? 'bg-neutral-800' : 'bg-slate-50'} ${textColor}`}>{pct}%</span>
                    </div>
                    <div className="flex items-baseline gap-1">
                    <span className={`text-xl font-bold ${valueColor}`}>{Math.round(safeValue)}</span>
                    <span className={`text-[10px] ${darkMode ? 'text-neutral-600' : 'text-slate-400'}`}>{unit}</span>
                    </div>
                    <div className={`w-full h-1 rounded-full mt-2 ${darkMode ? 'bg-neutral-800' : 'bg-slate-100'} overflow-hidden`}>
                    <div className={`h-full rounded-full transition-all duration-1000 ${color}`} style={{ width: `${Math.min(pct, 100)}%` }}></div>
                    </div>
                </div>
                );
            };

            const WaterPanel = () => {
                const target = 4000;
                const current = waterData.count * 250;
                const fillPct = Math.min((current / target) * 100, 100);
                
                // Time Logic for Hydration
                const now = currentTime;
                const currentHour = now.getHours();
                const currentMin = now.getMinutes();
                const startHour = 8;
                const endHour = 22;
                
                // Calculate Expected Progress
                const totalMinutes = (endHour - startHour) * 60;
                const elapsedMinutes = Math.max(0, ((currentHour - startHour) * 60) + currentMin);
                const expectedPct = Math.min(100, Math.max(0, (elapsedMinutes / totalMinutes) * 100));
                const expectedAmount = (expectedPct / 100) * target;
                const diff = current - expectedAmount;
                
                let status = "Sleeping";
                let statusColor = "text-neutral-500";
                
                if (currentHour >= startHour && currentHour < endHour) {
                    if (diff >= 200) { status = "Ahead"; statusColor = "text-emerald-500"; }
                    else if (diff >= -200) { status = "On Track"; statusColor = "text-blue-500"; }
                    else { status = "Behind"; statusColor = "text-orange-500"; }
                } else if (currentHour >= endHour) {
                    status = current >= target ? "Goal Met" : "Finished";
                    statusColor = current >= target ? "text-emerald-500" : "text-neutral-500";
                }
                return (
                <div className={`p-3 rounded-2xl border shadow-sm relative overflow-hidden flex flex-row items-center gap-4 h-40 ${darkMode ? 'bg-gradient-to-b from-neutral-900 to-neutral-950 border-neutral-800' : 'bg-white border-slate-100'}`}>
                    
                    {/* LEFT: FUEL ROD GAUGE */}
                    <div className="relative h-32 w-12 flex-shrink-0 flex items-center justify-center">
                         {/* Tube Container */}
                         <div className={`w-10 h-full rounded-full border-2 relative overflow-hidden ${darkMode ? 'border-neutral-700 bg-neutral-900' : 'border-slate-300 bg-slate-100'}`}>
                            {/* Liquid Fill */}
                            <div 
                                className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-orange-600 via-orange-500 to-amber-400 transition-all duration-1000 ease-out liquid-glow"
                                style={{ height: `${fillPct}%` }}
                            >
                                <div className="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmIiBmaWxsLW9wYWNpdHk9IjAuMSIvPgo8L3N2Zz4=')] opacity-30"></div>
                            </div>
                            
                            {/* Glass Shine */}
                            <div className="absolute top-0 left-1.5 bottom-0 w-2.5 bg-white/20 rounded-full blur-[2px]"></div>
                            
                            {/* Markers */}
                            <div className="absolute top-[25%] left-0 right-0 h-px bg-black/10 dark:bg-white/10"></div>
                            <div className="absolute top-[50%] left-0 right-0 h-px bg-black/10 dark:bg-white/10"></div>
                            <div className="absolute top-[75%] left-0 right-0 h-px bg-black/10 dark:bg-white/10"></div>
                        </div>
                    </div>

                    {/* RIGHT: INFO & CONTROLS */}
                    <div className="flex-1 flex flex-col justify-between h-32 py-1 min-w-0">
                        <div>
                            <div className="flex justify-between items-start">
                                <h3 className={`font-bold flex items-center gap-1.5 text-sm ${darkMode ? 'text-white' : 'text-slate-900'}`}><span className="text-orange-500"><Icons.Droplet /></span> Hydro-Fuel</h3>
                                <span className={`text-[10px] font-bold uppercase tracking-wider px-1.5 py-0.5 rounded bg-neutral-800/50 ${statusColor}`}>{status}</span>
                            </div>
                            
                            <div className="mt-2">
                                <div className="flex items-baseline gap-1">
                                    <span className={`text-2xl font-black ${darkMode ? 'text-white' : 'text-slate-900'}`}>{current}</span>
                                    <span className="text-xs font-medium opacity-50">ml</span>
                                </div>
                                <div className="text-[10px] opacity-40 font-mono">Target: {target}ml</div>
                            </div>
                        </div>
                        <div className="flex gap-2 mt-auto">
                            <button onClick={() => updateWater(-1)} className={`h-9 w-10 rounded-lg flex items-center justify-center border transition-all active:scale-95 ${darkMode ? 'border-neutral-700 hover:bg-neutral-800 text-neutral-400' : 'border-slate-200 hover:bg-slate-50 text-slate-500'}`}>
                                <Icons.Minus />
                            </button>
                            <button onClick={() => updateWater(1)} className="flex-1 h-9 rounded-lg flex items-center justify-center gap-2 font-bold text-xs bg-gradient-to-r from-orange-600 to-red-600 text-white hover:from-orange-500 hover:to-red-500 active:scale-95 transition-all shadow-lg shadow-orange-500/20 border border-orange-400/20">
                                <Icons.Plus /> <span>250ml</span>
                            </button>
                        </div>
                    </div>
                </div>
                );
            };

            // NEW COMPACT MACRO CHART
            const MacroChart = () => {
                const p = (totals.protein || 0) * 4;
                const c = (totals.carbs || 0) * 4;
                const f = (totals.fat || 0) * 9;
                const totalCal = p + c + f || 1;
                
                const pPct = (p / totalCal) * 100;
                const cPct = (c / totalCal) * 100;
                const fPct = (f / totalCal) * 100;

                // SVG calculations
                const radius = 36;
                const stroke = 8;
                const normalizedRadius = radius - stroke / 2;
                const circumference = normalizedRadius * 2 * Math.PI;
                
                const pDash = (pPct / 100) * circumference;
                const cDash = (cPct / 100) * circumference;
                const fDash = (fPct / 100) * circumference;

                return (
                <div className={`p-3 rounded-2xl border shadow-sm flex flex-row items-center gap-4 h-40 ${darkMode ? 'bg-gradient-to-b from-neutral-900 to-neutral-950 border-neutral-800' : 'bg-white border-slate-100'}`}>
                    
                    {/* LEFT: COMPACT DONUT */}
                    <div className="relative h-32 w-32 flex-shrink-0 flex items-center justify-center">
                        <svg height="120" width="120" viewBox="0 0 80 80" className="transform -rotate-90">
                            <circle stroke={darkMode ? "#171717" : "#f1f5f9"} strokeWidth={stroke} r={normalizedRadius} cx="40" cy="40" fill="transparent" />
                            {/* Fat (Orange) */}
                            <circle stroke="#f59e0b" strokeDasharray={`${fDash} ${circumference}`} strokeDashoffset={-(pDash + cDash)} strokeLinecap="round" strokeWidth={stroke} r={normalizedRadius} cx="40" cy="40" fill="transparent" className="transition-all duration-1000" />
                            {/* Carbs (Emerald) */}
                            <circle stroke="#10b981" strokeDasharray={`${cDash} ${circumference}`} strokeDashoffset={-pDash} strokeLinecap="round" strokeWidth={stroke} r={normalizedRadius} cx="40" cy="40" fill="transparent" className="transition-all duration-1000" />
                            {/* Protein (Blue) */}
                            <circle stroke="#3b82f6" strokeDasharray={`${pDash} ${circumference}`} strokeDashoffset="0" strokeLinecap="round" strokeWidth={stroke} r={normalizedRadius} cx="40" cy="40" fill="transparent" className="transition-all duration-1000" />
                        </svg>
                        <div className="absolute inset-0 flex flex-col items-center justify-center">
                            <span className={`text-xl font-black ${darkMode ? 'text-white' : 'text-slate-900'}`}>{Math.round(totals.calories)}</span>
                            <span className="text-[8px] uppercase font-bold text-neutral-500">Kcal</span>
                        </div>
                    </div>

                    {/* RIGHT: DETAILED LEGEND */}
                    <div className="flex-1 flex flex-col justify-center gap-3 min-w-0">
                         {/* Protein Row */}
                         <div className="flex flex-col gap-1">
                            <div className="flex justify-between items-center text-[10px]">
                                <span className="font-bold text-blue-500">Protein</span>
                                <span className={darkMode ? 'text-neutral-300' : 'text-slate-700'}>{Math.round(totals.protein)}g <span className="opacity-50">({Math.round(pPct)}%)</span></span>
                            </div>
                            <div className={`w-full h-1.5 rounded-full overflow-hidden ${darkMode ? 'bg-neutral-800' : 'bg-slate-100'}`}>
                                <div className="h-full rounded-full bg-blue-500" style={{width: `${Math.min((totals.protein/54)*100, 100)}%`}}></div>
                            </div>
                         </div>
                         {/* Carbs Row */}
                         <div className="flex flex-col gap-1">
                            <div className="flex justify-between items-center text-[10px]">
                                <span className="font-bold text-emerald-500">Carbs</span>
                                <span className={darkMode ? 'text-neutral-300' : 'text-slate-700'}>{Math.round(totals.carbs)}g <span className="opacity-50">({Math.round(cPct)}%)</span></span>
                            </div>
                            <div className={`w-full h-1.5 rounded-full overflow-hidden ${darkMode ? 'bg-neutral-800' : 'bg-slate-100'}`}>
                                <div className="h-full rounded-full bg-emerald-500" style={{width: `${Math.min((totals.carbs/300)*100, 100)}%`}}></div>
                            </div>
                         </div>
                         {/* Fat Row */}
                         <div className="flex flex-col gap-1">
                            <div className="flex justify-between items-center text-[10px]">
                                <span className="font-bold text-amber-500">Fat</span>
                                <span className={darkMode ? 'text-neutral-300' : 'text-slate-700'}>{Math.round(totals.fat)}g <span className="opacity-50">({Math.round(fPct)}%)</span></span>
                            </div>
                            <div className={`w-full h-1.5 rounded-full overflow-hidden ${darkMode ? 'bg-neutral-800' : 'bg-slate-100'}`}>
                                <div className="h-full rounded-full bg-amber-500" style={{width: `${Math.min((totals.fat/60)*100, 100)}%`}}></div>
                            </div>
                         </div>
                    </div>
                </div>
                );
            };

            const AdvancedMetrics = () => {
                const omegaRatio = totals.omega3 > 0 ? (totals.omega6 / totals.omega3) : 99;
                const ratioText = omegaRatio < 5 ? 'Excellent' : (omegaRatio < 10 ? 'Fair' : 'Inflamed');
                const ratioColor = omegaRatio < 5 ? 'text-emerald-500' : (omegaRatio < 10 ? 'text-amber-500' : 'text-red-500');
                const ratioPos = Math.min(Math.max((omegaRatio / 20) * 100, 0), 100);

                return (
                    <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                         <div className={`p-3 rounded-2xl border shadow-sm ${darkMode ? 'bg-gradient-to-b from-neutral-900 to-neutral-950 border-neutral-800' : 'bg-white border-slate-100'}`}>
                            <div className="flex justify-between items-start mb-3">
                                <div><h3 className="font-bold flex items-center gap-2 text-sm"><Icons.Hair /> Hair & Skin</h3><p className="text-[10px] text-neutral-500 mt-0.5">Aesthetic Quality Score</p></div>
                                <div className={`text-xl font-bold ${hairSkinData.total > 80 ? 'text-emerald-500' : (hairSkinData.total > 50 ? 'text-amber-500' : 'text-red-500')}`}>{hairSkinData.total}</div>
                            </div>
                            <div className="grid grid-cols-4 gap-2 text-[9px] text-neutral-500 font-medium mb-2">
                                <div className="space-y-1"><div className="flex justify-between"><span>Zn</span><span className={hairSkinData.z < 10 ? 'text-red-500' : ''}>{Math.round((hairSkinData.z/15)*100)}%</span></div><div className="h-1 bg-gray-200 rounded-full overflow-hidden dark:bg-neutral-800"><div className="h-full bg-teal-500" style={{width: `${(hairSkinData.z/15)*100}%`}}></div></div></div>
                                <div className="space-y-1"><div className="flex justify-between"><span>VitA</span><span className={hairSkinData.a < 7 ? 'text-red-500' : ''}>{Math.round((hairSkinData.a/10)*100)}%</span></div><div className="h-1 bg-gray-200 rounded-full overflow-hidden dark:bg-neutral-800"><div className="h-full bg-orange-500" style={{width: `${(hairSkinData.a/10)*100}%`}}></div></div></div>
                                <div className="space-y-1"><div className="flex justify-between"><span>O-3</span><span>{Math.round((hairSkinData.o/15)*100)}%</span></div><div className="h-1 bg-gray-200 rounded-full overflow-hidden dark:bg-neutral-800"><div className="h-full bg-blue-500" style={{width: `${(hairSkinData.o/15)*100}%`}}></div></div></div>
                                <div className="space-y-1"><div className="flex justify-between"><span>VitE</span><span>{Math.round((hairSkinData.e/15)*100)}%</span></div><div className="h-1 bg-gray-200 rounded-full overflow-hidden dark:bg-neutral-800"><div className="h-full bg-pink-500" style={{width: `${(hairSkinData.e/15)*100}%`}}></div></div></div>
                            </div>
                            {smartTips.length > 0 && (
                                <div className={`mt-2 p-2 rounded-lg text-[10px] ${darkMode ? 'bg-neutral-800/50' : 'bg-slate-50'}`}>
                                    <div className="space-y-1">
                                        {smartTips.map((tip, i) => <div key={i} className="flex items-center gap-2"><span className="text-emerald-500">{tip.icon}</span><span className={darkMode ? 'text-neutral-300' : 'text-slate-700'}>{tip.text}</span></div>)}
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className={`p-3 rounded-2xl border shadow-sm ${darkMode ? 'bg-gradient-to-b from-neutral-900 to-neutral-950 border-neutral-800' : 'bg-white border-slate-100'}`}>
                            <div className="flex justify-between items-start mb-3">
                                <div><h3 className="font-bold flex items-center gap-2 text-sm"><Icons.Brain /> Inflammation</h3><p className="text-[10px] text-neutral-500 mt-0.5">Omega 6:3 Ratio</p></div>
                                <div className={`text-xl font-bold ${ratioColor}`}>{ratioText}</div>
                            </div>
                            <div className="relative h-4 bg-gradient-to-r from-emerald-500 via-amber-500 to-red-500 rounded-full mb-2 opacity-80">
                                <div className="absolute top-0 bottom-0 w-1 bg-white border border-black shadow-lg transform -translate-x-1/2 transition-all duration-1000 rounded-full z-10" style={{left: `${ratioPos}%`}}></div>
                            </div>
                            <div className="flex justify-between text-[9px] text-neutral-500 font-medium mb-3"><span>1:1 (Ideal)</span><span>Current: {omegaRatio.toFixed(1)}:1</span><span>20:1 (Bad)</span></div>
                            <div className="grid grid-cols-2 gap-3">
                                <div className={`p-2 rounded-lg ${darkMode ? 'bg-blue-900/20' : 'bg-blue-50'}`}><span className="block text-[9px] text-blue-500 uppercase font-bold">Omega-3</span><span className={`text-sm font-bold ${darkMode ? 'text-blue-400' : 'text-blue-700'}`}>{totals.omega3.toFixed(1)}g</span></div>
                                <div className={`p-2 rounded-lg ${darkMode ? 'bg-amber-900/20' : 'bg-amber-50'}`}><span className="block text-[9px] text-amber-500 uppercase font-bold">Omega-6</span><span className={`text-sm font-bold ${darkMode ? 'text-amber-400' : 'text-amber-700'}`}>{totals.omega6.toFixed(1)}g</span></div>
                            </div>
                        </div>
                    </div>
                )
            };

            const Recommendations = () => {
                const recs = [];
                if (totals.fat > 68) recs.push({ color: 'red', text: `Fat is high (${(totals.fat || 0).toFixed(1)}g). Stick to Amul Taaza.` });
                if ((totals.protein || 0) < 54) recs.push({ color: 'red', text: "Protein low. Add more Channa or Dal." });
                if (totals.oxalate > 500) { recs.push({ color: 'red', text: `Extreme Oxalate Load! Drink 5L water or reduce seeds.` }); } 
                else {
                    const ratio = totals.calcium / (totals.oxalate || 1);
                    if (ratio < 2 && totals.oxalate > 100) recs.push({ color: 'red', text: "Low Calcium Shield! Drink more milk." });
                    else if (totals.oxalate > 100) recs.push({ color: 'green', text: `Kidney Safety: Excellent (Ratio ${ratio.toFixed(1)})` });
                }
                if (totals.sodium > 2300) recs.push({ color: 'red', icon: <Icons.Water />, text: `Sodium High (${Math.round(totals.sodium)}mg). Reduce Salt/Pickles.` });
                
                const omegaRatio = totals.omega3 > 0 ? (totals.omega6 / totals.omega3) : 99;
                if (omegaRatio > 10) recs.push({ color: 'red', icon: <Icons.Alert />, text: `Inflammatory Fat Profile (Ratio ${omegaRatio.toFixed(1)}). Add Chia Seeds or Walnuts.` });
                if (totals.vitD < 15) recs.push({ color: 'yellow', icon: <Icons.Sun />, text: `Vitamin D Low. Ensure supplement or sun exposure.` });
                if (totals.vitB12 < 2.2) recs.push({ color: 'yellow', icon: <Icons.Pill />, text: `Vitamin B12 Low. Ensure supplement.` });

                return (
                <div className={`rounded-xl shadow-sm border p-4 sm:p-5 mt-4 transition-colors ${darkMode ? 'bg-gradient-to-b from-neutral-900 to-neutral-950 border-neutral-800' : 'bg-white border-slate-200'}`}>
                    <h4 className={`font-bold flex items-center gap-2 mb-3 text-sm ${darkMode ? 'text-neutral-200' : 'text-slate-800'}`}><Icons.Shield /> Smart Analysis</h4>
                    <div className="space-y-2">
                    {recs.map((rec, i) => (
                        <div key={i} className={`p-3 rounded-lg text-xs sm:text-sm border-l-4 flex gap-3 items-center ${rec.color === 'red' ? (darkMode ? 'bg-red-900/20 border-red-500 text-red-200' : 'bg-red-50 border-red-500 text-red-800') : (rec.color === 'yellow' ? (darkMode ? 'bg-yellow-900/20 border-yellow-500 text-yellow-200' : 'bg-yellow-50 border-yellow-500 text-yellow-800') : (darkMode ? 'bg-green-900/20 border-green-500 text-green-200' : 'bg-green-50 border-green-500 text-green-800'))}`}>
                        {rec.icon ? rec.icon : (rec.color === 'red' ? <Icons.Alert /> : <Icons.Check />)} {rec.text}
                        </div>
                    ))}
                    </div>
                </div>
                );
            };

            return (
                <div className={`min-h-screen font-sans bg-slate-50 text-slate-900 transition-colors duration-300 ${darkMode ? 'bg-neutral-950' : 'bg-slate-50'}`}>
                <header className={`sticky top-0 z-50 border-b backdrop-blur-xl transition-colors ${darkMode ? 'bg-neutral-950/80 border-neutral-800' : 'bg-white/80 border-slate-200'}`}>
                    <div className="max-w-7xl mx-auto px-3 md:px-4 h-14 flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold text-sm shadow-lg ${darkMode ? 'bg-orange-600 shadow-orange-500/20' : 'bg-indigo-600 shadow-indigo-500/30'}`}>N</div>
                        <div><h1 className={`font-bold leading-tight text-xs ${darkMode ? 'text-white' : 'text-slate-900'}`}>Nutrition OS</h1><p className={`text-[9px] font-bold tracking-widest uppercase ${darkMode ? 'text-orange-500' : 'text-orange-600'}`}>SOLID ED2026</p></div>
                    </div>
                    <div className="flex items-center gap-3">
                        <div className={`hidden md:flex p-1 rounded-lg ${darkMode ? 'bg-neutral-800' : 'bg-slate-100'}`}>
                        {['dashboard', 'ideal plan', 'schedule'].map(tab => (
                            <button key={tab} onClick={() => handleTabChange(tab)} className={`px-4 py-1.5 rounded-md text-xs font-bold capitalize tracking-wide transition-all ${activeTab === tab ? (darkMode ? 'bg-neutral-700 text-white shadow-sm' : 'bg-white text-indigo-600 shadow-sm') : 'text-neutral-500 hover:text-neutral-300'}`}>{tab}</button>
                        ))}
                        </div>
                        <button onClick={toggleDarkMode} className={`p-2 rounded-xl transition-all duration-300 relative overflow-hidden group ${darkMode ? 'bg-neutral-800 text-orange-400 shadow-[0_0_15px_rgba(251,146,60,0.3)] border border-orange-500/30' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                            {darkMode && <div className="absolute inset-0 bg-orange-500/10 blur-md"></div>}
                            <div className="relative z-10">{darkMode ? <Icons.Sun /> : <Icons.Moon />}</div>
                        </button>
                    </div>
                    </div>
                </header>

                <main className="w-full max-w-7xl mx-auto py-4 px-3 md:px-4 sm:py-8 pb-4 md:pb-10">
                    {activeTab === 'dashboard' && (
                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-4 lg:gap-8 animate-fade-in">
                        
                        {/* INPUT PANEL */}
                        <div className="lg:col-span-4 space-y-4 order-2 lg:order-1">
                        <div className={`rounded-2xl border shadow-sm overflow-hidden flex flex-col lg:h-[calc(100vh-140px)] sticky top-20 lg:top-24 ${darkMode ? 'bg-gradient-to-b from-neutral-900 to-neutral-950 border-neutral-800' : 'bg-white border-slate-200'}`}>
                            <div className={`px-4 py-3 border-b flex justify-between items-center ${darkMode ? 'border-neutral-800' : 'border-slate-100'}`}>
                            <h3 className="font-bold text-xs text-neutral-500 uppercase tracking-wider">Daily Intake</h3>
                            <button onClick={resetToIdeal} className={`text-[10px] px-2.5 py-1 rounded-md font-bold flex items-center gap-1.5 transition-colors ${darkMode ? 'bg-neutral-800 text-orange-400 hover:bg-neutral-700' : 'bg-indigo-50 text-indigo-600 hover:bg-indigo-100'}`}><Icons.Reset /> Reset</button>
                            </div>
                            <div className="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1.5">
                            {Object.entries(foodDatabase).map(([cat, items]) => (
                                <div key={cat} className={`rounded-lg overflow-hidden border transition-all ${darkMode ? 'bg-neutral-950 border-neutral-800' : 'bg-slate-50 border-slate-200'}`}>
                                <button onClick={() => toggleCategory(cat)} className={`w-full flex items-center justify-between px-3 py-2 text-[10px] font-bold uppercase tracking-wider transition-colors ${darkMode ? 'text-neutral-400 hover:bg-neutral-800' : 'text-slate-500 hover:bg-slate-100'}`}>
                                    {cat}
                                    <span className={`transform transition-transform duration-200 ${expandedCategories[cat] ? 'rotate-180' : ''}`}><Icons.ChevronDown /></span>
                                </button>
                                {expandedCategories[cat] && (
                                    <div className={`px-2 pb-2 space-y-1 border-t ${darkMode ? 'border-neutral-800' : 'border-slate-200'}`}>
                                    {Object.keys(items).map(food => (
                                        <div key={food} className={`flex items-center justify-between p-1.5 rounded-lg group transition-colors ${darkMode ? 'hover:bg-neutral-800' : 'hover:bg-white hover:shadow-sm'}`}>
                                        <label className={`text-[11px] font-medium truncate flex-1 cursor-pointer mr-2 ${darkMode ? 'text-neutral-300' : 'text-slate-700'}`} htmlFor={food}>{food}</label>
                                        <div className="relative">
                                            <input id={food} type="number" step="0.1" min="0" value={quantities[food] || 0} onFocus={(e) => e.target.select()} onChange={(e) => handleQuantityChange(food, e.target.value)} className={`w-12 pl-1 pr-1 py-0.5 text-center text-[11px] rounded border outline-none focus:ring-1 focus:ring-indigo-500 font-mono transition-all ${quantities[food] > 0 ? (darkMode ? 'bg-indigo-900/30 border-indigo-500 text-indigo-400 font-bold' : 'bg-white border-indigo-300 text-indigo-700 font-bold shadow-sm') : (darkMode ? 'bg-neutral-800 border-neutral-700 text-neutral-500' : 'bg-slate-100 border-slate-200 text-slate-400')}`} />
                                        </div>
                                        </div>
                                    ))}
                                    </div>
                                )}
                                </div>
                            ))}
                            </div>
                        </div>
                        </div>

                        {/* DASHBOARD PANEL */}
                        <div className="lg:col-span-8 space-y-4 order-1 lg:order-2">
                        
                        {/* Top Cards */}
                        <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                            <StatCard label="Calories" value={totals.calories} max={rda.calories} unit="kcal" inverse={false} />
                            <StatCard label="Protein" value={totals.protein} max={rda.protein} unit="g" inverse={false} />
                            <StatCard label="Fat" value={totals.fat} max={rda.fat} unit="g" inverse={true} />
                            <StatCard label="Sodium" value={totals.sodium} max={rda.sodium} unit="mg" inverse={true} />
                        </div>
                        
                        {/* Macro Left, Water Right */}
                        <div className="grid md:grid-cols-2 gap-4">
                            <MacroChart />
                            <WaterPanel />
                        </div>
                        
                        <AdvancedMetrics />
                        
                        <div className={`rounded-2xl border shadow-sm overflow-hidden ${darkMode ? 'bg-gradient-to-b from-neutral-900 to-neutral-950 border-neutral-800' : 'bg-white border-slate-200'}`}>
                            <div className={`px-4 py-3 border-b ${darkMode ? 'border-neutral-800' : 'border-slate-100'}`}>
                            <h3 className={`font-bold text-sm ${darkMode ? 'text-neutral-200' : 'text-slate-800'}`}>Nutrient Breakdown</h3>
                            </div>
                            <div className="overflow-x-auto">
                            <table className="w-full text-[10px] sm:text-xs text-left">
                                <thead className={`text-[9px] uppercase font-bold ${darkMode ? 'bg-neutral-950 text-neutral-500 border-b border-neutral-800' : 'bg-slate-50 text-slate-500 border-b border-slate-200'}`}>
                                <tr>
                                    <th className="px-2 py-2 w-1/3">Nutrient</th>
                                    <th className="px-2 py-2 w-1/4">Total</th>
                                    <th className="px-2 py-2 w-1/4">Target</th>
                                    <th className="px-2 py-2 text-right w-1/6">Status</th>
                                </tr>
                                </thead>
                                <tbody className={`divide-y ${darkMode ? 'divide-neutral-800' : 'divide-slate-100'}`}>
                                {Object.entries(nutrientDisplayCategories).map(([cat, keys]) => (
                                    <React.Fragment key={cat}>
                                    <tr className={darkMode ? 'bg-neutral-950/50' : 'bg-slate-50'}><td colSpan="4" className={`px-2 py-1.5 text-[9px] uppercase font-bold tracking-widest ${darkMode ? 'text-neutral-500' : 'text-slate-400'}`}>{cat}</td></tr>
                                    {keys.map(item => { 
                                        const val = totals[item.k] || 0;
                                        const target = rda[item.k];
                                        const pct = target ? Math.min((val / target) * 100, 100) : 0;
                                        return (
                                        <tr key={item.k} className={`group transition-colors ${darkMode ? 'hover:bg-neutral-800/40' : 'hover:bg-white'}`}>
                                            <td className="px-2 py-2">
                                                <div className="flex items-center">
                                                    <span className={`flex items-center justify-center w-6 h-6 mr-2 rounded-md ${item.bg} ${item.text}`}>{item.icon}</span>
                                                    <div>
                                                        <div className={`font-semibold ${darkMode ? 'text-neutral-200' : 'text-slate-700'}`}>{item.l}</div>
                                                        <div className="text-[9px] text-neutral-500">{item.s}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td className={`px-2 py-2`}>
                                                <div className={`font-mono font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>{val.toFixed(1)} <span className="text-[9px] opacity-50 font-sans">{item.u}</span></div>
                                                {target && <div className={`w-12 h-0.5 mt-1 rounded-full ${darkMode ? 'bg-neutral-800' : 'bg-slate-200'}`}><div className={`h-full rounded-full ${pct >= 100 ? 'bg-emerald-500' : (pct < 70 ? 'bg-red-500' : 'bg-amber-500')}`} style={{width: `${pct}%`}}></div></div>}
                                            </td>
                                            <td className={`px-2 py-2 font-mono ${darkMode ? 'text-neutral-500' : 'text-slate-400'}`}>{target ? target : '-'}</td>
                                            <td className="px-2 py-2 text-right">{getStatusBadge(val, target, item.k)}</td>
                                        </tr>
                                        );
                                    })}
                                    </React.Fragment>
                                ))}
                                </tbody>
                            </table>
                            </div>
                        </div>
                        <Recommendations />
                        </div>
                    </div>
                    )}

                    {activeTab === 'ideal plan' && (
                    <div className="max-w-4xl mx-auto space-y-4 animate-fade-in">
                        <div className={`p-6 rounded-2xl text-center border ${darkMode ? 'bg-gradient-to-b from-neutral-900 to-neutral-950 border-neutral-800' : 'bg-gradient-to-br from-indigo-50 to-white border-indigo-100'}`}>
                        <h2 className={`text-xl font-bold mb-1 ${darkMode ? 'text-neutral-200' : 'text-indigo-900'}`}>The Fat-Loss Reference Protocol</h2>
                        <p className={`text-xs ${darkMode ? 'text-neutral-400' : 'text-indigo-600'}`}>Strictly calibrated quantities for maximum protein, minimum fat, and kidney safety.</p>
                        </div>
                        <div className="grid sm:grid-cols-2 gap-3">
                            {[
                                { f: "Amul Taaza Milk", q: "1.0", m: "250ml", w: "High Calcium (375mg) + Low Fat. Critical for blocking evening oxalates.", icon: <Icons.Beaker /> },
                                { f: "Amul Dahi", q: "1.0", m: "200g Cup", w: "Probiotics + Calcium base for the morning oxalate mix.", icon: <Icons.Beaker /> },
                                { f: "Roasted Channa", q: "1.2", m: "60g", w: "High protein (19%) fiber snack. Exact 60g target.", icon: <Icons.Muscle /> },
                                { f: "Peanuts", q: "0.0", m: "Removed", w: "Removed to save fat calories for the fat-loss goal.", icon: <Icons.Alert /> },
                                { f: "Dal (Cooked)", q: "1.5", m: "2 Katori", w: "Primary Iron source (10mg). Needs Vit C for absorption.", icon: <Icons.Fire /> },
                                { f: "Roti", q: "0.8", m: "2 Medium", w: "Carb control. Do not exceed if also eating rice.", icon: <Icons.Grain /> },
                                { f: "Pumpkin Seeds", q: "1.0", m: "2 tsp (~10g)", w: "Zinc boost for immunity.", icon: <Icons.Shield /> },
                                { f: "Sunflower Seeds", q: "1.0", m: "1 tsp (~5g)", w: "Vitamin E for skin health.", icon: <Icons.Hair /> },
                                { f: "Chia Seeds", q: "0.8", m: "2 tsp (~10g)", w: "Hydrating Fiber Gel. Must soak before eating.", icon: <Icons.Leaf /> },
                                { f: "Sesame Seeds", q: "1.0", m: "1 tsp (~5g)", w: "Additional Calcium source.", icon: <Icons.Bone /> },
                                { f: "Moringa Powder", q: "1.0", m: "2 tsp (~6g)", w: "Nutrient density.", icon: <Icons.Leaf /> }
                            ].map((row, i) => (
                                <div key={i} className={`p-4 rounded-xl border flex gap-3 items-start transition hover:shadow-md ${darkMode ? 'bg-neutral-900 border-neutral-800 hover:bg-neutral-800' : 'bg-white border-slate-100'}`}>
                                    <div className={`p-2.5 rounded-lg ${darkMode ? 'bg-neutral-800 text-neutral-400' : 'bg-slate-50 text-slate-500'}`}>{row.icon}</div>
                                    <div>
                                        <h4 className={`font-bold text-sm ${darkMode ? 'text-white' : 'text-slate-900'}`}>{row.f}</h4>
                                        <div className="flex gap-2 text-xs font-mono my-1"><span className="bg-blue-500/10 text-blue-600 px-1.5 py-0.5 rounded">{row.q} x</span><span className={darkMode ? 'text-neutral-400' : 'text-slate-500'}>{row.m}</span></div>
                                        <p className="text-[10px] opacity-60 leading-relaxed">{row.w}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                    )}

                    {activeTab === 'schedule' && (
                    <div className="max-w-3xl mx-auto space-y-6 animate-fade-in">
                        <div className="relative border-l-2 border-indigo-500/20 ml-4 space-y-8 pb-12">
                        {[
                            { time: "8:00 AM", title: "The 'Safety Shield' Mix", color: "indigo", icon: <Icons.Shield />, items: ['Soak 2 tsp Chia (15 min) in water', 'Mix Dahi + 1 tsp Sesame + 1 tsp Sunflower + 2 tsp Pumpkin', 'Add 2 tsp Moringa + Nuts', 'Eat Mix', 'Take Vit D3 (1000 IU) - Needs Fat', 'Drink 300ml Water (Essential for Fiber)'] },
                            { time: "1:00 PM", title: "Iron Absorption Lunch", color: "orange", icon: <Icons.Fire />, items: ['Eat Dal (2 Katori) + Roti + Sabzi', 'NO Tea/Coffee (1 hr gap before/after)', 'Take Vit C (125mg) after eating', 'Walk 10 mins'] },
                            { time: "5:00 PM", title: "Protein & Calcium Snack", color: "blue", icon: <Icons.Droplet />, items: ['Eat Roasted Channa (60g / 1.2 Mutthi)', 'Drink Amul Taaza (250ml) WITH FOOD'] },
                            { time: "8:00 PM", title: "Light Dinner", color: "green", icon: <Icons.Moon />, items: ['Eat Light (Dal + Sabzi)', 'Avoid extra Rice if possible', 'Walk 15 mins'] },
                            { time: "10:00 PM", title: "Night Routine", color: "teal", icon: <Icons.Water />, items: ['Finish Water Goal (4L)', 'Sleep 7-8hrs'] }
                        ].map((slot, i) => (
                            <div key={i} className="relative pl-8">
                            <div className={`absolute -left-2.5 top-0 w-5 h-5 rounded-full border-4 shadow-sm z-10 ${darkMode ? `bg-neutral-900 border-${slot.color}-500` : `bg-white border-${slot.color}-500`}`}></div>
                            <div className={`p-5 rounded-xl border shadow-sm transition-all hover:shadow-md ${darkMode ? 'bg-gradient-to-b from-neutral-900 to-neutral-950 border-neutral-800' : 'bg-white border-slate-100'}`}>
                                <div className="flex justify-between items-start mb-3">
                                <div><span className={`text-[10px] font-bold uppercase tracking-wider text-${slot.color}-500`}>{slot.time}</span><h3 className={`text-lg font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>{slot.title}</h3></div>
                                <div className={`p-2 rounded-lg bg-${slot.color}-500/10 text-${slot.color}-500`}>{slot.icon}</div>
                                </div>
                                <div className="space-y-2.5">
                                {slot.items.map((task, k) => {
                                    const id = `${i}-${k}`;
                                    return (
                                    <label key={id} className="flex items-start gap-3 cursor-pointer group select-none">
                                        <div className={`mt-0.5 w-4 h-4 shrink-0 rounded border flex items-center justify-center transition-colors ${checklist[id] ? `bg-${slot.color}-500 border-${slot.color}-500 text-white` : (darkMode ? 'border-neutral-700 bg-neutral-800' : 'border-slate-300 bg-white')}`}>{checklist[id] && <Icons.Check />}</div>
                                        <input type="checkbox" className="hidden" checked={!!checklist[id]} onChange={() => toggleCheck(id)} />
                                        <span className={`text-xs transition-all ${checklist[id] ? 'line-through opacity-50' : ''} ${darkMode ? 'text-neutral-300' : 'text-slate-700'}`}>{task}</span>
                                    </label>
                                    );
                                })}
                                </div>
                            </div>
                            </div>
                        ))}
                        </div>
                    </div>
                    )}
                    
                    {/* Bottom Spacer for Floating Nav */}
                    <div className="h-24 md:hidden"></div>
                </main>

                {/* MOBILE FLOATING DOCK NAVIGATION */}
                <div className="md:hidden fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-sm z-50">
                    <div className={`flex justify-between items-center px-2 py-2 rounded-2xl shadow-2xl glass-nav border ${darkMode ? 'bg-neutral-900/80 border-white/10' : 'bg-white/80 border-black/5'}`}>
                        {['dashboard', 'ideal plan', 'schedule'].map(tab => (
                            <button key={tab} onClick={() => handleTabChange(tab)} className={`flex-1 flex flex-col items-center gap-1 py-2 rounded-xl transition-all ${activeTab === tab ? 'bg-gradient-to-tr from-orange-500 to-red-600 text-white shadow-lg shadow-orange-500/30' : (darkMode ? 'text-neutral-400' : 'text-neutral-500')}`}>
                                <span className="text-[10px] font-bold uppercase tracking-widest">{tab}</span>
                            </button>
                        ))}
                    </div>
                </div>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
